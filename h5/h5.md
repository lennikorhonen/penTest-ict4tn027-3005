# H5

Viikon 5 tehtävät

## Lue artikkelit ja katso videot

### Kolme vapaavalintaista walkthrough artikkelia

Lähde: [0xdf europa](https://0xdf.gitlab.io/2021/02/02/htb-europa.html)

- Ensin ajettiin nmap ja katsottiin aukinaiset portit sekä nmapin löytämät domainit
- Seuraavaksi fuzzattiin domaineja wfuzz työkalulla, josta ei löytynyt mitään mitä nmapilla ei löytynyt
- Sitten mentiin nampilla löytyneelle admin-portal subdomain sivulle, josta löytyi kirjautumis sivu
- Seuraavaksi koitettiin asettaa `'` merkki sposti kenttään kun kokeiltiin SQL injektiota, ja löydettiin login request burp suitella. 
Burp suiten avulla laitettiin spostin perään `'` merkki ja siitä saadulla vastauksella huomattiin mahdollisuus SQL injektiolle. Tästä myös
näkyi käytössä oleva MD5 hashi
- Sitten koitettiin SQL kyselyillä millä tavalla sivun PHP ajaa kyselyn. Ensin koitettiin SQL Bypassiä ja sen avulla päästiin sisään admin
tunnuksilla.
- Seuraavaksi koitettiin SQL Data Dump/Carck tyyppistä injektiota. Tässä hyödynnettiin sqlmappia ja Burp suitea. Näillä päästiin kirjautumatta
käsiksi tietokantaan ja löydettiin adminin salasana hashattynä ja <https://hashes.org> sivu näytti hashin selkokielellä.
- Admin paneelin päästyä avattiin tools sivu admin paneelissa, jossa on openvpn config generator
- Täällä pystyi määrittämään ip:n konfiguraatiolle
- 0xdf kiinntti myös huomiota POST viestiin mikä lähetettiin kun luotiin uusi konfiguraatio
- Tästä pääteltiin, että voitaisiin käyttää php:n funktiota `preg_replace` päästäkseen shelliin
- Tämän ja python3:n PTY kikalla pääsi käsiksi shelliin
- Seuraavaksi cronjobeista löytyi ajettava tiedosto, joka tyhjensi acces.log tiedoston ja ajoit logcleared.sh tiedoston jota ei ollut
olemassa
- Näiden tietojen avulla saatiin rootit koneelle siten, että luotiin logcleared.sh tiedosto ja tämä laittoi julkisen SSH avaimen
sallittuihin avaimiin

Lähde: [0xdf Omni](https://0xdf.gitlab.io/2021/01/09/htb-omni.html#)

- Ensin aloitettiin tiedustelulla ja löydettiin kuusi avoinna olevaa porttia.
- Portista 8080 löytyi verkkosivu, josta aukesi Windows Device Portal
- Tämän jälkeen koitettiin RCE:tä mutta se ei täysin toiminut
- Seuraavaksi löytyikin, että tässä laatikosssa on staging area, tämän avulla saatiin Windows koneesees System käyttäjänä tunnukset
- Ensimmäinen tapa saada app käyttäjän tunnukset oli dumpata hashit registrystä luomalla SMB share, jolle kirjoitettaisiin 
python skriptillä
- Sitten mountattiin share Omnista RCE "RAT" avulla ja ajettiin reg save, jotta saadaan backupit kolmesta vaadittavasta "hivestä"
- Tämän jälkeen käytettiin python scriptiä jolla saatiin dumpattua hashit
- Hashit saatiin cräkättyä tällä <https://github.com/mxrch/penglab>
- Toinen tapa millä hankittiin app käyttäjän tunnukset oli käyttää remotena python dump scriptiä
- Koska oltiin SYSTEM käyttäjä lisättiin ensin uusi käyttäjä admin oikeuksilla, tämä käyttäjä ei näkynyt admin listassa, tästä pääteltiin,
että täytyy toimia nopeasti
- Seuraavaksi luotiin tunneli porttiin 445
- Sitten ajettiin ping 1 sekunnin viiveellä ja samalla komennolla lisättiin käyttäjä admin ryhmään, toisessa ikkunassa ajettiin python
scripti, jolla saatiin hashatyt salasanat.
- Kolmannella tavalla löydettiin ensin automoitu bat tiedosto joka poistaa kaikki admin käyttäjät, siellä näkyi myös adminin ja app
käyttäjän salasanat
- Saadut tunnukset toimivat portissa 8080 olevaan Windows Device Portaaliin, jossa pystyi ajamaan komentoja
- Seuraavaksi avattiin sama shelli ncatillä
- App käyttäjänä pystyttiin decryptamaan salasana user.txt tiedostosta
- App käyttäjän kansioista löytyi kaksi muuta tiedostoa jotka herättivät huomiota, toisen app käyttäjä pystyi decryptamaan ja saamaan
sieltä admin käyttäjän salasanan
- admin käyttäjänä pystyttiin vielä decryptamaan root.txt jaa saamaan sieltä salasana flag käyttäjälle.

Lähde: [0xdf Doctor](https://0xdf.gitlab.io/2021/02/06/htb-doctor.html)

- Aluksi aloitettiin taas tiedustellalla ja nmapilla löytyi kolme avointa porttia
- Portista 8089 löytyi Splunkd jolla exposataan REST API, tähän löytyi verkosta mahdollinen exploitti mutta siihen tarvitaan tunnukset
- Portista 80 löytyi verkkosivu ja `doctors.htb` sivulta löytyi kirjautumis sivu, mikään perus SQLi ei toiminut mutta siellä oli sign up
now linkki josta lisäämällä käyttäjän sai 20min ajaksi tunnukset
- Sivu oli tyhjä mutta sinne pystyi lisämään uusia viestejä
- Sivun lähdekoodissa referoidaan `/archive` sivulle ja siellä käymällä se palauttaa XML muodossa kaikki sivulle lähetetyt viestit
- Python pohjaiset sivut ovat usein haavoittuvia SSTI(Server Side Template Injection) hyökkäyksille joten seuraavaksi koitettiin sitä
- Tämä ei kumminkaan näyttänyt toimivan, joten tarkistettiin `/archive` uudestaan ja siellä näkyi, että se olikin onnistunut
- Seuraavaksi koitettiin `{{7*'7'}}` ja huomattiin, että käytössä on jinja2 tai twig
- Seuraavaksi käytettiin RCE payloadia [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#exploit-the-ssti-by-calling-popen-without-guessing-the-offset) githubista
tällä saatiin web käyttäjänä shell käyttöön
- Toinen tapa oli koittaa XSS hyökkäystä, tästä ei kumminkaan irronnut mitään
- Seuraavaksi koitettiin netcatilla saada palvelimesta tietoa ja postata viesti verkkosivulla mutta formi tekee jonkun linkki
validoinnin mahdollisesti, koska linkkiä ei pystynyt lähettämään
- Command Injcectionin mahdollisuus todistettiin lisäämällä `$(whoami)` ip osoitteen perään
- Seuraavaksi sitä hyödynnettiin lisäämään ssh avain palvelimelle Command Injektiolla ja mentiin ssh:lla web käyttäjälle
- Shellin sai käyttöön myös käyttämällä `nc.traditional` payloadia.
- Kun on päästy web käyttäjänä sisään nähdään toinen käyttäjä shaun
- Web käyttäjä kuuluu myös adm ryhmään jolla on pääsy lokeihin, lokeista löytyi kohta, jossa on resetoitu salasana ja lukee `email=Guitar123`,
joka vaikuttaa salasanalta eikä sähköpostilta
- Myös LinPEAS työkalulla olisi löytänyt saman, jolloin ei olisi tarvinnut manuaalisesti käydä näitä
- Guitar123 oli shaunin salasana ja käyttäjää vaihtamalla päästiin lukemaan shaunin kotikansiossa oleva `user.txt`
- Shaunin tunnuksilla pääsi kirjautumaan Splunk järjestelmään ja sieltä aukesi paljon lisää funktioita
- <https://github.com/cnotin/SplunkWhisperer2.git> löytyvällä payloadilla ensin testattiin pingin kanssa, että voiko tätä kautta päästä
sisään ja sen jälkeen ping vaihettiin reverse shelliin, tätä monitoroitiin tcpdumpin avulla
- Näillä pääsi käsiksi root.txt tiedostoon roottina
- Tässä walkthroughssa oli myös paljon monimutkaisempi menetelmä, joilla sai Shaunin tunnukset käyttöön

### Kolme vapaavalintaista läpikävelyvideota

Lähde: [IppSec Bastion](https://www.youtube.com/watch?v=2j3FNp5pjQ4)

- Aloitetaan taas nmapilla ja löytyi avoimet portit 22, 135, 139 ja 445 ja Käyttöjärjestelmä on Windows
- Sitten hyödynnettiin SMB:tä ja Mountattiin Backup share omalle koneelle
- Seuraavaksi tutkittiin mitä Backupista löytyy, ja löytyi vhd tiedosto joka listattiin 7zipin avulla
- Tämä vhd mountattiin guestmountin avulla
- Täältä löytyi käyttäjien hashejä, ja yhden käyttäjän tunnuksilla pääsi sisään kun ne oltiin dehashatty
- Niillä tunnuksilla otettiin ssh yhteys koneeseen ja siellä otettiin käyttöön JAWS enumerator
- Koneeltä löytyi myös mremoteNG kansio ja ladattiin githubista python skripti jolla decryptataan salasana mremoteNG:n tiedostoista
- Sieltä saadulta salasanalla saatin Adminstratorin salasana ja sillä salasanalla päästiin ssh:lla sisään

Lähde: [IppSec Writeup](https://www.youtube.com/watch?v=GKq4cwBfH24)

- Ensin ajettiin nmap ja saatiin kaksi avointa porttia: 22 ja 80
- Sivuilta löytyi, että siellä käytetää CMS Made Simple content manageria ja heidän netti sivuilta löytyi svn linkki jossa näkyi kaikki
peruus kansiot/tiedostot mitä se tekee, joten näitä lähdettiin kokeilemaan seuraavaksi
- doc kansiosta löytyi CHANGELOG.txt tiedosto josta pystyi katsomaan viimeisimmän version mikä tuolla palvelimella on
- Searchsploitilla tutkittiin mitä haavoittuvuuksia CMS:stä löytyy sille versiolla ja löytyi SQL injektio haavoittuvuus
- Searchsploitista ladattiin tämä exploitti ja ajettiin se kohteeseen
- Samalla tutkittiin ja selitettiin miten SQLi toimii wiresharkin ja burpsuiten avulla
- Seuraavaksi otettiin käyttöön hashcat jolla cräkättiin salasana
- salasanalla ja searchsploitista saadulla käyttäjänimellä päästiin ssh:lla sisään koneeseen
- Sitten laitettiin python http palvelin pystyyn josta pystyi lataamaan LinEnum.sh nimisen skriptin ja ladattiin se kohteeseen `wgetillä`
- Skriptillä löytyi yksi staff group kohteesta, jolla voi muokata `/usr/local` kansiossa ilman root oikeuksia
- Tämä kun oli haettiin ensin omalle koneelle `pspy` työkalu ja sen jälkeen ladattiin se kohteelle `wgetillä`
- Tämän jälkeen ajettiin pspy jolla koitettiin kaapata prosessi, jossa ei ole absoluuttista pathiä
- Tällainen prosessi löytyi ja sen niminen skripti luotiin mitä prosessissa ajettiin, tällä skriptillä laitettiin ssh avain rootille
- Lopuksi otettiin ssh yhteys roottiin

Lähde: [IppSec Time](https://www.youtube.com/watch?v=JfonPpbX-oI)
**Tässä videossa myös hyviä vinkkejä kuinka ottaa ylös asioita penauksessa**

- Korkkaus taas aloitettiin nmapillaä ja löytyi vain 22 ja 80 portit
- Portista 80 löytyi sivu jossa pystyi parsimaan Jsonin "kivempaan muotoon" tai validoimaan sen
- Seuraavaksi löydettiin kokeilemalla mitä Json parseria käytetään ja etsittiin siihen exploitti googlesta
- Löydetyllä komennolla saatiin pitkä StackOverflow error
- Writeupin lukemista jatkamalla löytyi, että voi antaa JSON muodossa komennon jolla sanotaan, että on java tietokanta
- Tällä komennolla saatiin lisää tietoja koneesta
- Seuraavaksi ajettiin SQLi jolla saatiin reverse shell yhteys
- Seuraavaksi ajettiin LinPEAS, jolla etsittiin tietoja kohteesta
- Seuraavaksi muokattiin teidostoa johon on kirjoitus oikeus ja se ajetaan automaattisesti
- Tällä saatiin rootit 
- Lopuksi käytiin vielä monimutkaisempi tapa


## Etsi ja kokeile 5 uutta työkalua
1. Wfuzz
- Kokeilin ensin wfuzz työkalua, jolla käydään läpi kaikki ali kansiot mitä on määritelty wordlistissä. Tällaisi wordlistejä on wfuzzin
githubissa läjäpäin eri tarkoituksiin ja itse kopion sieltä yleisimmän wordlistin. Komennolla `wfuzz -w wordlist/general/common.txt "http://localhost:80/FUZZ"`
sai ajettua kommennon. Tässä tuo /FUZZ endpoint on tärkeä, koska muuten wfuzz antaa virhe viestin. Lisäämällä `--hc 404` sai myös piilotettua
kaikki 404 antaneet endpointit.
2. netcat
- Tässä kohdassa jouduin etsimään enemmän verkosta, että miten tämä toimii ja käytin [tätä ohjetta](https://www.hackingtutorials.org/networking/hacking-with-netcat-part-1-the-basics/),
jossa kirjauduttiin netcatilla metasploitable2 FTP:hen. Ensin täytyi vain yhdistää netcat FTP porttiin ja sen jälkeen lähettää netcatillä
käyttäjänimi ja salasna.
3. tcpdump
- Tcpdump oli vastaava kuin wireshark mutta tcpdumpista puuttui mahdollisuus tarkemmin tarkastella liikennettä ja se pyöri
kokonaan cli:ssä. Komennolla `tcpdump -i eth1` sai tcpdumin käyntiin ja kuuntelemaan eth1 verkkokorttia
4. Searchsploit
- Searchsploitilla voi helposti hakea eri palveluiden heikkouksia. Siihen riittää komento `searchsploit ftp` esimerkiksi kun etsii ftp
haavoittuvuuksia.
5. LinPEAS
- Lopuksi koitin [LinPEAS](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) työkalua, jolla etsitään kohteesta
mahdollisia tapoja millä eskaloida paikallisia oikeuksia. Tässä vaadittiin ensin, että laittaa samassa kansiossa missä skripti sijaitsee,
python http serverin päälle ja sen jälkeen lähettää kohteesta curl pyynnön, että ladataan ja ajetaan skripti: `curl ip-osoite/linpeas.sh | sh`


## Tiedustele ja analysoi 5 htb konetta perusteellisesti.

1. HTB Delivery
`sudo nmap -sV 10.10.10.222 -oA deliveryVer`
```sh
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-02 11:29 EEST
Nmap scan report for 10.10.10.222
Host is up (0.046s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
80/tcp open  http    nginx 1.14.2
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.83 seconds
```
- Nmap skannauksesta selvisi, että palvelin on Debian 10 palvelin eli uusin julkaistu versio, mutta OpenSSH versio on 7.9p1, joka on
2018 julkaistu versio ja pienellä googlettelulla siitä löytyi haavoittuvuus. Myös nginx oli kohta johon kiinnitti huomiota ja myös sen 
version googlettamisella löytyi haavoittuvuus.

`eyewitness --single http://10.10.10.222`
![Eyewitness report](./img/eyewitnessReportDeliv.png)

- Eyewitness työkalulla en saanut saanut mitään uutta irti ja sivulla ei ollut myöskään kirjautumis ikkunaa

`nikto -host 10.10.10.222`
```sh
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          10.10.10.222
+ Target Hostname:    10.10.10.222
+ Target Port:        80
+ Start Time:         2021-05-02 12:08:25 (GMT3)
---------------------------------------------------------------------------
+ Server: nginx/1.14.2
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ 7863 requests: 0 error(s) and 3 item(s) reported on remote host
+ End Time:           2021-05-02 12:14:43 (GMT3) (378 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```
- Nikto työkalulla sain tietää, että sivuilla ei ole anti-clickjacking X-Frame-Options headeriä, X-XSS-Protection headeriä ja 
X-Content-Type-Options headeriä. Näiden headerien puuttumisen takia voisi olla jotain XSS mahdollisuuksia.

- Tunkeutumista jatkaisin luultavasti msfconsolella, jossa etsisin aiemmin verkosta löytyneet havvoittuvuudet ssh:lle 
ja/tai nginx:lle ja hyödyntäisin sitä

2. HTB Script Kiddie

`sudo nmap -sV -sS 10.10.10.226 -oA scriptkiddieVer`
```sh
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-02 15:29 EEST
Nmap scan report for 10.10.10.226
Host is up (0.044s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
5000/tcp open  http    Werkzeug httpd 0.16.1 (Python 3.8.5)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.03 seconds
```

- Nmapista selvisi, että laitteessa on ssh ja http palvelut auki, mutta http on portissa 5000 ja käyttää Werkzeug httpd palvelua. Openssh
on tällä laitteella uusimassa versiossa. Werkzeug versio 0.16.1 on viimeisin versio ennen 1.0 mutta uusin versio palvelusta on 1.0.1 ja
uusin pre-release versio on 2.0.0rc4. Searchsploitilla löytyi kaksi exploittia werkzeugille.

`eyewitness --single http://10.10.10.226:5000`

![eyewitRepSK](./img/eyewitRepSK.png)

- Eyewitness työkalu ei tuonut kuvan lisäksi mitään uutta mitä, en vielä tiennyt palvelimesta. Kuvassa näkyi, että sivulla mahdollisesti
voisi ajaa komentoja palvelimelta. Sivulla käydessä ja nmap ja sploits kohtaa kokeillessa sai vaikutksen sivun oikealle puolelle tulevista
tuolosteista, että sivu ajaisi kommennot jossain ja palauttaisi ne.

`nikto -host 10.10.10.226:5000`
- Myöskään nikto ei tuonut mitään lisää

- Jatkaisin tästä koittamalla ajaa jotain shell koodia nettisivuilla ja koittaisin saada msfconsolella hyödynnettyä werkzeug
haavoittuvuuksia. Sivulla myös yhteen kenttään sai ladattua tiedostoja omalta koneelta joten koittasin etsiä netistä jonkun skriptin 
tähän tarkoitukseen jos sillä saisi vuodettua jotain sivulta.

3. HTB Spectra

`sudo nmap -sV -sS 10.10.10.229 -oA spectra`
```sh
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-02 18:27 EEST
Nmap scan report for 10.10.10.229
Host is up (0.049s latency).
Not shown: 996 closed ports
PORT     STATE SERVICE          VERSION
22/tcp   open  ssh              OpenSSH 8.1 (protocol 2.0)
80/tcp   open  http             nginx 1.17.4
3306/tcp open  mysql            MySQL (unauthorized)
8081/tcp open  blackice-icecap?

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.57 seconds
```
- Nmap skannista selvisi, että tässä boxissa on auki portit 22, 80, 3306, 8081. MySQL versiota en saanut tietoon ja portissa 8081
pyörivä softa ei antanut kuin veikatun tuloksen joka oli blackice-icecap. Nginx versio oli hieman vanha ja openssh versioon löytyi
haavoittuvuus, jossa mainittiin myös hyökkäystyyppi "Spectre", joka muistuttaa hyvin paljon boxin nimeä.

- Sivulla klikatessa ensimmäistä linkkiä aukesi Software Issue Management sivu, jossa yhdessä kohdassa luki "Just an other WordPress site",
joten kokeilin wpscannia. wpscannin ajamalla vain `10.10.10.299` osoitteeseen tuli vastaus, että ei olisi wordpress sivu. Mutta ajamalla
sen `10.10.10.299/main` osoitteeseen sai ulos dataa wpsannista.

```sh
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.14
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://10.10.10.229/main/ [10.10.10.229]
[+] Started: Sun May  2 19:35:45 2021

Interesting Finding(s):

[+] Headers
 | Interesting Entries:
 |  - Server: nginx/1.17.4
 |  - X-Powered-By: PHP/5.6.40
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://10.10.10.229/main/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access

[+] WordPress readme found: http://10.10.10.229/main/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://10.10.10.229/main/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10).
 | Found By: Emoji Settings (Passive Detection)
 |  - http://10.10.10.229/main/, Match: 'wp-includes\/js\/wp-emoji-release.min.js?ver=5.4.2'
 | Confirmed By: Meta Generator (Passive Detection)
 |  - http://10.10.10.229/main/, Match: 'WordPress 5.4.2'

[i] The main theme could not be detected.

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:00:02 <=============================> (137 / 137) 100.00% Time: 00:00:02

[i] No Config Backups Found.

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 50 daily requests by registering at https://wpscan.com/register

[+] Finished: Sun May  2 19:35:52 2021
[+] Requests Done: 164
[+] Cached Requests: 4
[+] Data Sent: 41.657 KB
[+] Data Received: 110.49 KB
[+] Memory used: 178.461 MB
[+] Elapsed time: 00:00:06
```
- Tästä pystyi päättelemään, että MySQL oli yhteydessä tähän wordpressiin. PHP versio vaikutti todella vanhalta, koska uusin versio on 8.0
ja nopealla tutkinnalla löytyi, että versio 5.6.40 on noin 7 vuotta vanha ja sen eol on menny 3 vuotta sitten. Myöskään wordpress versio
ei ole uusimmasta päästä mutta uudempi kuin PHP.

- Tämän boxin tunkeutumistestausta lähtisin jatkamaan etsimällä PHP:stä haavoittuvuuksia ja hyödyntämllä msfconsolea sen haavoittuvuuden
kättöön. Etsisin myös mysql haavoittuvuuksia joita hyödyntäisin msfconsolen kautta.

4. HTB Ready

`sudo nmap -sV -sS 10.10.10.220 -oA ready`
```sh
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-02 19:58 EEST
Nmap scan report for 10.10.10.220
Host is up (0.044s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
5080/tcp open  http    nginx
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 14.57 seconds
```

- Nmap skannista selivisi, että laatikossa on kaksi porttia auki, 22/tcp ja 5080/tcp. OpenSSH versio oli kohtuu uusi ja nginx versiota
ei tullut nmapissa

`eyewitness --single 10.10.10.220:5080`
![eyewitnessReady](./img/eyewitReady.png)

- Eyewitness raportissa näkyi, että sivu on GitLab community edition sivu ja siellä on kirjautumis ja rekisteröitymis sivut. Info kohdassa
mikään ei kiinnittänyt huomiota.

`nikto -host 10.10.10.220:5080`
```sh
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          10.10.10.220
+ Target Hostname:    10.10.10.220
+ Target Port:        5080
+ Start Time:         2021-05-02 20:39:37 (GMT3)
---------------------------------------------------------------------------
+ Server: nginx
+ Uncommon header 'x-runtime' found, with contents: 0.009171
+ Uncommon header 'x-request-id' found, with contents: bce6cbb8-4839-487f-a053-7e26f1b27d50
+ Root page / redirects to: http://10.10.10.220/users/sign_in
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Entry '/autocomplete/users/' in robots.txt returned a non-forbidden or redirect HTTP code (200)
+ Entry '/search/' in robots.txt returned a non-forbidden or redirect HTTP code (200)
+ Entry '/help/' in robots.txt returned a non-forbidden or redirect HTTP code (200)
+ Entry '/users/sign_in/' in robots.txt returned a non-forbidden or redirect HTTP code (200)
+ "robots.txt" contains 53 entries which should be manually viewed.
+ OSVDB-630: The web server may reveal its internal or real IP in the Location header via a request to / over HTTP/1.0. The value is "172.19.0.2".
+ /help/: Help directory should not be accessible
+ OSVDB-3092: /public/: This might be interesting...
+ OSVDB-3092: /search.vts: This might be interesting...
+ OSVDB-3092: /test/: This might be interesting...
+ Uncommon header 'x-gitlab-custom-error' found, with contents: 1
+ /help.php: A help file was found.
+ /.well-known/openid-configuration: OpenID Provider Configuration Information.
+ 7918 requests: 0 error(s) and 15 item(s) reported on remote host
+ End Time:           2021-05-02 20:48:41 (GMT3) (544 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```
- Nikton tulosteessa kiinnitin eniten huomiota `/.well-known/openid-configuration` kohtaan, jonne menemällä näkyi json muodossa dataa 
ja ensimmäisellä rivillä "issuer" nimen takana oli toinen ip osoite `172.19.0.2`

- Tätä laatikkoa jatkaisin kokeilemalla, että voinko luoda tunnukset ja mihin kaikkialle niillä tunnuksilla on pääsy. Koittaisin myös
etsiä nginx:lle haavoittuvuutta ja hyödyntää niitä msfconsolella.

5. HTB Tenet

`sudo nmap -sV -sS 10.10.10.223 -oA tenet`

```sh
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-02 21:45 EEST
Nmap scan report for 10.10.10.223
Host is up (0.046s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.93 seconds
```
- Nmapin skannin tulosteessa ssh versio oli aika vanha ja apachen versioita tutkimalla tuolla versiolla (2.4.29) oli paljon haavoittuvuuksia.

- Eyewitness ei antanut mitään erityistä muuta kuin näki, että siellä on vain default apache2 sivu.

`nikto -host 10.10.10.223`
```sh
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          10.10.10.223
+ Target Hostname:    10.10.10.223
+ Target Port:        80
+ Start Time:         2021-05-02 22:07:28 (GMT3)
---------------------------------------------------------------------------
+ Server: Apache/2.4.29 (Ubuntu)
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Server may leak inodes via ETags, header found with file /, inode: 2aa6, size: 5b6930b5181c7, mtime: gzip
+ Apache/2.4.29 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.
+ Allowed HTTP Methods: GET, POST, OPTIONS, HEAD 
+ OSVDB-3233: /icons/README: Apache default file found.
+ 7863 requests: 0 error(s) and 7 item(s) reported on remote host
+ End Time:           2021-05-02 22:14:38 (GMT3) (430 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```
- Nikton tuloksena sain liä tietoon, että boxissa olevan apache2 version eol päivä on jo päättynyt.

- Boxin korkkaamista jatkaisin msfconsolen kanssa ja etsisin sieltä apache2:lle haavoittuvuuden ja koittaisin hyödyntää sitä.

## Nimeä 1-3 walktrough:ta, joissa tunkeudutaan samantapaisiin palveluihin, joita käsittelit kohdassa b.

[0xdf tenten](https://0xdf.gitlab.io/2020/07/14/htb-tenten.html#recon)

- Tämä laatikko oli vastaava kuin viides laatikko johon tein aktiivista tiedustelua. Tässä ajettiin gobuster ja wpscan kohteen sivulle. Vaikka
en ylempänä raportoinut sitä niin myös tenet boxi oli wordpress boxi(se piti vain lisätä `/etc/hosts` tiedostoon).

- Gobuster työkalulla en löytänyt tuosta laatikosta muuta kuin kaksi wordpress tiedostoa. Gobuster toimi vastaavasti kuin ffuf tai wfuzz eli 
piti määritellä sanalista urlin lisäksi. Gobusterissa piti myös erikseen määritellä mitä modea käytetään. Koitin itse dir modea jolla
enumeroidaan kansioita ja tiedostoja.

- Lisää uusia työkaluja en tähän hätään löytänyt kun alkoi työaika loppumaan. Ehkä ensi viikolla sitten paremmin.


## Tehtävien lähteet
<https://terokarvinen.com/2021/hakkerointi-kurssi-tunkeutumistestaus-ict4tn027-3005/>
