# H6

Viikon 6 tehtävät

## Katso ja tiivistä muutamalla ranskalaisella viivalla

Lähde: [Santos et al 2017](https://learning.oreilly.com/videos/security-penetration-testing/9780134833989/9780134833989-sptt_00_06_00_00)

- MITM
- Julkisessa verkossa verkon kuuntelu
- Hydra, Medusa, Metasploit, Brutus
- Jotkut algoritmit liian heikkoja, Windowsissa ei ole salttia
- Salasanoja aiemmista breacheistä
- John the Ripper yksi suosituimmista salasana crackereistä
- `john --show file.txt` näyttää mitkä salasanat on avattu siinä tiedostossa missä hashit ovat
- john.pot tiedostosta löytää kaikki cräcätyt käyttäjnimi+salasana parit
- `--format` määrittää mitä algoritmiä käytetään
- John käyttää CPU:ta
- Hashcat käyttää taas näytönohjainta
- 2fa tai multi-fa aina käytössä kun mahdollista


## Lisää linkki tehtäviisi tämän sivun perään kommentiksi

- Lisäsin viimeksi kun oli tehtävän mutta ei silloin jotain syystä mennyt läpi, lisäsin nyt uudelleen

## Tee 3 tiivistettä eri ohjelmilla ja murra ne hashcatilla.

- md5 hash komennolla `echo -n "password" | md5sum | tr -d " -" > md5hash.txt`
- sha256 hash `echo -n "12345678" | sha256sum | tr -d " -" > sha256hash.txt`
- sha1 hash `echo -n "salasana1" | sha1sum | tr -d " -" > sha1hash.txt`

- `sudo hashcat -m 0 -a 3 -o md5crack.txt ~/md5hash.txt rockyou.txt` komento ajettaessa saatiin oikea salasana auki md5 muodolle
- `sudo hashcat -m 1400 -a 3 -o sha256crack.txt ~/md5hash.txt rockyou.txt` saatiin avattua sha256 hashatty salasana
- `sudo hashcat -m 100 -a 3 -o ~/sha1crack.txt ~/sha1hash.txt commonpass.txt` kolmantena avasin sha1 hashatyn salasanan, tässä käytin
lyhyttä salasana listaa, koska rockyou listalla olisi mennyt todella pitkään 

## Tee oma sanalista itse tekemästäsi ja keksimästäsi weppisivusta.

- Laitoin ensin python/flask kirjautumis formin [täältä löytyvällä koodilla](https://pythonspot.com/flask-web-forms/)
- Seuraavaksi ajoin komennon `cewl localhost:5000 -w cewllist.txt` jolla sain samalla tallennettua sanat tiedostoon

## Kokeile sanakirjahyökkäystä verkon yli omaan weppilomakkeeseen.

- Käynnistin metasplottable2 virtuaali koneen tätä tehtävää varten
- Sen jälkeen lisäsin lyhyeen sanalistaan metasplottable2 koneen tunnukset
- Seuraavaksi ajoin hydra komennon `sudo hydra -L common.txt -P common.txt -t 4 ssh://192.168.56.102`
- Näillä komennoilla löytyi oikeat tunnukset ja salasanat
![Hydra output](./img/hydraoutput.png./img/hydraoutput.png)

## Murra jonkin tiedoston salajanasuojaus.

- Harjoitusta varten loin gpg avaimen `gpg --gen-key` 
- Seuraavaksi exporttasin tiedostoksi avaimen komennolla `gpg --export-secret-key --armor test > test.priv`
- Tämän jälkeen gpg avain pitää kääntää john the ripperille sopivaksi komennolla `gpg2john test.priv > gpghashtest`
- Lopuksi ajetaan vain `john gpghashtest` ja tällä saadaan salasana auki
![John The Ripper output](./img/JTR.png)

## Vapaaehtoinen bonus: Tee oma ohjelma, joka murtaa tiivisteitä.

- Kirjoitin pythonilla ohjelman joka murtaa md5 hashattyjä tiivisteitä

```python
import hashlib


def main():
    break_hash()


def break_hash():
    hash_to_crack = input('Give hash: ')
    with open('./common.txt') as passwords:
        pswd_list = passwords.read().split('\n')
        print(pswd_list)
        i = 0
        # Go through the list
        while i <= len(pswd_list):
            # Hash the word on list
            hashed = hashlib.md5(pswd_list[i].encode('utf-8')).hexdigest()
            print(hashed)
            # If hashes match print the hash and break the loop
            if hash_to_crack==hashed:
                print('This is the password:',pswd_list[i])
                break
            i += 1


if __name__ == "__main__":
    main()
```

- Tämä on todella simppeli ja alkeellinen ohjelma tiivisteiden murtoon
- Tätä voisi kehittää eteenpäin esim. siten, että ohjelma saa listan eri tiivisteistä tai yhdestä tiivisteestä ja ajaa ne/sen annettua listaa varten.

## Tehtävien lähteet
<https://terokarvinen.com/2021/hakkerointi-kurssi-tunkeutumistestaus-ict4tn027-3005/>
