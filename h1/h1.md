# H1
Viikko 1 tehtävät

## A) Hanki kutsu HackTheBoxiin.

Sivulla hackthebox.eu/invite hankitaan kutsu seuraavasti:
- Ensin avataan F12 näppäimellä verkkosivun konsoli ja tutkitaan Debuggerilla netti sivun teidostoja
- Sivulta löytyy tiedosto inviteapi.min.js joka on obfuskoitunut tämä pitää joko deobfuskoida tai huomata, että tiedoston lopussa on
määritelty funktio makeInviteCode.
- Kun tuon ajaa selaimen konsolissa saa enkoodatun stringing ja myös enkoodaus menetelmän joka on base64.
- Tämä stringi täytyy deenkoodata josta saa ohjeen, että täytyy lähettää post kutsu https://www.hackthebox.eu/api/invite/generate
- Sieltä tulee vastaukseksi taas base64 enkoodattu stringi ja kun tämän deenkoodaa saa oikean kutsu koodin

## B) Asenna WebGoat ja kokeile, että pääset kirjautumaan sisään.
WebGoatin asensin ja tein tunnukset Teron ohjeiden mukaan täältä https://terokarvinen.com/2020/install-webgoat-web-pentest-practice-target/

## C) Ratkaise WebGoatista tehtävät "HTTP Basics", "Developer tools", "CIA Triad" ja "A1 Injection (intro)"

### HTTP Basics
Ensimmäisessä kohdassa syötettiin vain oma nimi teksti kenttään ja tämän jälkeen palvelin palautti sen väärinpäin.
Kohdassa kaksi kysyttiin, että käytettiinkö edellisessä kohdassa POST vai GET kutsua ja mikä on "magic number". Tämän ratkaisin
siten, että avasin network välilehden selaimessa valmiiksi ja vastasin POST ensimmäiseen kenttään ja magic numberiksi laitoin 42 (eli vain 
joku arvo). Tämän jälkeen klikkasin networkissä tekemääni POST kutsua ja sieltä tutkin Requestit josta sain vastauksen magic numberiin joka on 79

### Developer tools
Tässä tehtävässä käytiin ensin läpi selaimen Developer toolsseja.
Ensimmäisessa kohdassa ajettiin konsolissa funktio webgoa.customjs.phoneHome() ja tästä sai palautteena satunnaisen numeron tähän tehtävään
ja muita tulosteita.
Toisessa osassa avattiin network osio dev tooleista ja klikattiin nappia sivulla. Tämän jälkeen tutkittiin lähetettyä POST kutsua ja siellä
request kohdasta löydettiin networkNum jonka numero laitettiin vastauksen.

### CIA Triad
Tässä tehtävässä oli tehtävänä käydä läpi CIA Triad eli kolme tärkeintä komponenttia turvallisissa systeemeissä. CIA tulee sanoista confidential,
integrity ja availability. Lopuksi oli vielä testi tästä aiheesta, jossa oli 5 kysymystä.

### A1 Injection (intro)
Tässä tehtävässä opiskeltiin SQL injektiota.
Ensimmäisessa kohdassa koitettiin hakea tietyn henkilön osasto tietokannasta. Tämä tehtävä ratkaistiin tällä SQL lausekkeella: 
`SELECT department FROM employees WHERE first_name = 'Bob';`
Toisessa kohdassa tehtiin DML tyypin SQL injektio eli datan manipulointia. Tässä tehtävässä piti päivittää henkilön osasto ja se ratkaistiin
seuraavasti: `UPDATE employees SET department = 'Sales' WHERE first_name = 'Tobi';`
Kolmannessa kohdassa tehtiin DDL tyypin SQL injektio eli uudelleen määriteltiin olemassa olevan taulun sisältö. Tämä kohta ratkaistiin näin:
`ALTER TABLE employees ADD phone varchar(20);`
Neljäs kohta kävi läpi DCL tyypin SQL injektion, jolla annetaan luvattomalle käyttäjälle oikeuksia tai poistetaan toiselta
käyttäjältä oikeuksia tietokannasta. Tässä piti antaa UnathorizedUser nimiselle käyttäjäryhmälle oikeudet muuntaa tauluja. Vastaus näyttää
seuraavalta: `GRANT ALTER TABLE TO UnathorizedUser;`
Viidennessä kohdassa kokeiltiin erilaisten SQL komentojen ketjuttamista, jotta saatiin kaikki käyttäjä user taulusta. Laittamall alasveto
valkioista valinnat `'` ja `'1'='1` saatiin kaikki käyttäjien tiedot.
Kuudes kohta käsitteli numeerista SQL injektiota. Tässä piti asettaa kaksi eri numeerista arvoa joiden täytyi vuotaa käyttäjien tiedot.
Tehtävä ratkesi sillä että ensimmäiseen kenttää laittoi vain jonkun luvun ja toiseen kenttään `1 OR 1 = 1`. Näin tietokanta vuoti käyttäjätiedot.
Seitsemännessä tehtävässä tehtiin merkkijono SQL injektio. Tämä ratkesi laittamalla `Smith` työntekijän nimeksi ja autentikaatio TAN kohtaan
`' OR '1' = '1`
Kahdeksas kohta käsitteli SQL queryn ketjuttamista. Tässä tehtävssä piti muuttaa työntekijä Smithin palkka suurimmaksi. Tämän ratkaisin
näin: Ensimmäiseen kenttään `Smith' OR '1'='1'; UPDATE employees SET salary = '100000' WHERE last_name = 'Smith` ja toiseen kenttään 3SL99A eli
Smithin autentikaatio TAN.
Yhdeksäs ja viimeinen kohta käsitteli CIA triadin viimeiestä kohtaa eli saatavuutta(availability) ja siinä piti poistaa taulu access_log johon
on talentunut kaikki haut. Tämän kohdan ratkaisin seuraavalla SQL injektiolla: `';DROP TABLE access_log; --`

### Asenna Kali Linux virtuaalikoneeseen. Kokeile jotain Kalin mukana tulevaa työkalua paikalliseen localhost-osoitteeseen
Kali linuxin asentaminen VirtualBoxiin on erittäin suoraviivaista. Ensin täytyy asentaa VirtualBox ohjelmisto jos sitä ei vielä ole asentanut.
Tämän jälkeen täytyy asentaa Kalin live kuva tiedost uusimmasta versiosta (Myös vanhemman version voi ladata mutta todennäköisesti uusin 
versio on tietoturvallisn).
Seuraavaksi avataan virtualbox, jossa painetaan ylhäältä ensin new nappi ja siinä määritellään virtuaalikoneelle nimi, ja käyttöjärjestelmä.
Koska Kali linuxia ei löydy käyttöjärjestelmä listasta valitaan, joko Linux 2.6 tai uusin Debian versio. Tämän jälkeen määritellään
virtuaalikoneelle annettavan RAM muistin määrä ja valitaan millainen ja minkä kokoinen virtuaalikovalevy koneelle tulee. Tässä itse valitsin
dynaamisesti allokoidun kovalevyn, jolle annoin 30GB tilaa. RAM muistia annoin 6GB, koska minulta löytyy 16GB RAM muistia omalta laitteeltani.
Ennen koneen käynnistämistä muutin vielä sen verran asetuksia, että annoin koneelle 82MB video muistia ja 2 ydintä CPU:lle. Viimeiseksi
ennen käynnistämistä täytyi koneelle vielä listä aiemmin ladattu .iso tiedosto klikkaamalla [Optical Drive] Empty kohtaa Storagen alta ja lisätä
tiedosto koneeseen. Tämän jälkeen kun kone käynnistyy voi avata joko live version Kalista tai asentaa Kalin virtuaalikoneeseen.
Yritin nmap ohjelmaa ja metasploit ohjelmaa localhostissa mutta näistä en hirveästi vielä saanut mitään irti. Koitin myös niitä siten, että
laitoin ensin apache2 palvelimen päälle ja tämän jälkeen koitin molempia localhostissa. Näin sain pientä ymmärrystä siitä miten näitä kahta
ohjelmaa voisi käyttää yhdessä. Eli ensin esimerkiksi skannaa jonkun osoitteen kaikki portit ja sen jälkeen yhdistää sinne metsploitilla.

### Vapaaehtoinen: Ratkaise lisää WebGoat-tehtäviä. Kuinka pitkälle pääsit?
Tein kohdat HTTP proxies ja SQL Injection (advanced) 
### HTTP Proxies
Tässä tehtävässä opeteltiin ensin käyttämään OWASP Zap työkalua proxyna. Ensimmäiseksi piti konfiguroida Firefox, koska sen uusimmissa versioissa ei ole enään proxy liikennetää localhostissa.
Tehtävä itsessään oli kokeilla kuinka tämä Zap työkalu toimii siten, että laittaa breakpointit päälle jokaiseen request/response kohtaan. (!!Huom. tämä tehtävä piti olla auki Zapin kautta avatussa Firefoxissa.) Seuraavaksi piti painaa submit nappia ja ottaa ensimmäinen request kiinni ja muuttaa sieltä lähetettävä teksit `changeMe=Request are tampered easily` muotoon. Seuraavaksi muutettiin Method alasvetovalikosta POST request GET requestiksi. Tämä kannatti muutta sieltä, koska muuten URL ei mene oikeaan muotoon. Lopuksi lisäättin vielä yksi ylimääräinen header `x-request-intercepted: true`. Näiden muutosten jälkeen siirrttiin seuraavan breakpointtiin ja saatiin vastaukseksi: "Well donem you tampered the request as excepted" ja tehtävä meni suoritetuksi. Lopussa myös näytettiin, että lähetettyjä hyökkäyksiä voi lähettää uudelleen.
### SQL Injection (advanced)
Ensimmäisessä tehtävässä oli tarkoituksena saada dataa toisista tauluista mitä et tiedä vielä. a) Kohdassa piti saada ensin kaikki data taulusta `user_system_data`, johon on tallennettu käyttäjä nimet ja salasanat. Tuosta sai datan ulos laittamalla Name: kenttään `admin'; SELECT * FROM user_system_data; --`. Sen jälkeen piti vain ottaa Dave käyttäjän käyttäjänimi (dave) ja salasana (passW0rD) ja tehtävä ratksi sillä.
Seuraavassa kohdassa piti hyödyntää kaikkia SQL injektio tehtävien taitoja. Tehtävän tarkoituksena oli saada käyttäjän Tom kirjautumis tunnukset. Ensin koitin erilaisia vaihto ehtoja login ikkunassa kuten `tom' AND '1'='1` ja `admin' AND '1'='1` nämä eivät kumminkaan toimineet. Seuraavaksi koitin register ikkunassa saada jotain irti tietokannasta. Koittamalla `tom' AND '1'='1` saatiin tietokannalta vastaus, että käyttäjä löytyy jo. Seuraavaksi muutin käyttäjänimen muotoon `tom' AND substring(database_version(),1,1)=’1` ja koitin sillä saada tietoon tietokannan version ja vaihtamalla viimeisen numeron numeroon 2 sain vastaukseksi, että käyttäjä löytyy jo joten ajattelin, että voisiko tällä saada myös salasanan kaivettua esiin. Laitoin käyttäjänimen kohdalle `tom’ AND substring(password,1,1)=’t`, koska ajattelin, että tom voisi aloittaa salsanansa nimensä ensimmäisellä kirjaimella ja sieltä tuli vastaukseksi, että käyttäjä löytyy. Seuraavaksi etsin netistä, että millä voisin nopeammin käydä kirjaimi läpi. Löysin, että Burp suitella voi tehdä Intruder Sniper bruteforcen joka käy merkkejä läpi. Konfiguroin burp suiten tekemään sellaisen hyökkäyksen ja muutin aina `(password,1,1)` kohdasta ensimmäistä numeroa yhden isompaan kunnes sain salasanan. Hyökkäyksen jälkeen kävin aina jokaisen palvelimen vastauksen läpi, jotta näin milloin olen löytänyt uuden kirjaimen. `thisisasecretfortomonly` oli salasana mikä piti löytää. Viimeinen kohta oli kysely SQL injektioista.
