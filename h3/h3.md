# H3
Viikon kolme tehtävät

## Lue materiaali, ja tiivistä kukin muutamalla ranskalaisella viivalla.

### Social engineering
Lähde: Riku Juurikon kalvot Social Engineeringistä

- Social Engineeringillä tarkoitetaan mitä tahansa toimintaa millä vaikutetaan henkilöön siten, että hän tekee asioita riippumatta siitä
ovatko ne asioita mitä hän haluaisi tehdä.
- Social Engineering ei ole aina negatiivista
- Tiedä kohteesi ja kuku työskentelee kenelle
- Kerää dataa kohteesta(![osintframework](https://osintframework.com/), ![fonecta](fonecta.fi))
- Googlen haku syntaksi
- Anna toiselle jotain olettamatonta ja hyödy omasta ystävällisyydestäsi
- Tietoja hankkiessa pidä kohteen olo mukavana, saa heidät tuntemaan, että sinä luotat heihin.
- Saatavuuden rajallisuudesta kertominen
- Luo itsellesi expertin rooli, koska ihmisillä on tapana luottaa expertteihin
- Aloita pyytämällä pieniä palveluksia, kuten lainaatko kynää tai katsotko mun tavaroita kun käyn jossain
- Yritä olla "tykättävä", esim. pukeudu siistisi, ja pidä samoista asioista kuin kohteesi
- Sano, että kaikki muutkin tekevät näin
- Koita yhtenäistää sinua ja kohdettasi(**me**, **sinä**, **erityinen**)
- Kalastelu on yksi yleisimmistä hyökkäys vektoreista
        - Avaa haitallinen linkki
        - Lataa haitallinen tiedosto
        - tmv.
- SMS Kalastelu nousussa, koska ihmiset tietää, että sähköpostissa tulee kalasteluviestejä
        - Viestin voi lähettää samaan viestiketjuun kuin toisesta yrityksestä lähetetty viesti
- Puhelu kalastelu
        - Koitetaan puhelimessa saada Feikki It-tukena kirjautumis tunnuksia
- Haitallisen Social Engineering yrityksen voi tunnistaa siitä, että sinulla on tarve sanoa kyllä normaalia erikoisempiin asioihin

### OWASP10
Lähde: ![OWASP10](https://raw.githubusercontent.com/OWASP/Top10/master/2017/OWASP%20Top%2010-2017%20(en).pdf)

- A1 Injection
        - Mikä tahansa datan lähde voi olla injectio vektori
        - Ongelmat ovat todella yleisiä legacy koodissa
        - Injektio aiheuttaa kohteelle haittaa, kuten datan menttämistä, datan näkymistä henkilöille joille se ei kuulu(esim. valvomo
        case), välillä injektio voi johtaa siihen, että hyökkääjä saa täyden hallinnan datasta ja tietokannasta
        - Yleisimpiä injektioita ovat SQL, NoSQL, OS comnmand, ORM, LDAP ja Expression Language tai Object Graph Navigation Library Injection
        - Estääkseen injektion täytyy pitää data erillään komennoista ja kyselyistä

- A2 Broken Authentication
        - Hyökkääjillä pääsy satoihin miljooniin käyttäjänimi salasana pareihin
        - Hyökkääjät tunnistavat manuaalisilla toiminnoilla rikkinäisen autentikaation ja automoiduilla työkaluilla tekevät hyökkäyksen
        - Hyökkääjän on saatava vain muutamaan käyttäjään tai yhteen admin käyttäjään pääsy ja niillä hän saa koko systeemin vaarannettua
        - Välttääkseen autentikaatioon liittyvät hyökkäykset on käyttäjän identiteetin ja autentikaation varmistaminen sekä session hallinta
        kriittistä

- A3 Sensitive Data Exposure
        - Man in the middlle hyökkäyksiä, varastaa clear-text muotosta dataa suoraan palvelimilta
        - Viimeisinä vuosina yleisin vaikuttava hyökkäys
        - Yleensä tällä tavalla saadaan henkilökohtaista dataa
        - Esim. salasanat, luottokorttie tiedot, terveystiedot yms. vaatii lisä suojausta
        - Enkryptaa kaikki "herkkä" data

- A7 Cross Site Scripting
        - Automoidut työkalut voivat havaita ja hyödyntää kaikkia XSS:än kolmea muotoa
        - XSS on toiseksi yleisin onglema OWASPIN Top 10:ssä
        - XSS:llä voi esim. ajaa etänä koodia uhrin selaimessa
        - XSS:n kolme muotoa ovat Reflected XSS, Stored XSS ja DOM XSS, josta Stored XSS:ää pidetään yleensä vähintään korkeana tai
        jopa kriittisenä riskinä
        - Estääkseen XSS hyökkäyksen on hyvä erotella epäluotettava data aktiivisesta selain sisällöstä

### Hacking Web Applications The Art of Hacking
Lähde: ![Santos et al 2018](https://learning.oreilly.com/videos/hacking-web-applications/9780135261422/9780135261422-hwap_01_05_00_00)

- Session management tapahtuu sessionID:n avulla
- Autentikaatioita ovat mm: SSL/TLS, HTTP Basic Auth, HTTP Forms, Digest Acces Authentication, Lightweight Thrid-pary Authentication,
Oauth2, OpenID, OpenID connect ja SAML
- SSL/TLS idea on digitaalinen sertifikaatti, jolla muodostetaan yhteinen luottamus käyttäjän ja palvelun/verkkosivun välillä
- HTTP Basic Auth ei käytä keksejä ja vaatii, että selain jättää tunnukset välimuistiin. Tämä ei ole turvallinen, koska tässä tunnukset
menevät verkon yli.
- HTTP From-based Auth, vaatii SSL/TLS, koska muuten tunnukset näkyvät selko kielellä
- DAA lähettää vain MD5 hash:n, ei ole turvallinen, koska sen algoritmi on heikko
- LTPA, IBM:n menetelmä, suunniteltu SSO:lle
- OAuth2, pitää ensin rekisteröityä ensin palvelun tarjoajan palveluun, käyttäjän tunnuksest eivät ole koskaan näkyvissä sovellukselle

![Kuva oauth2](./img/oauth2.png)

- OpenID "autentikaatio identiteetillä", käyttäjällä voi olla yksi tunnus jollain joka jakaa OpenID palveluita ja voi sillä tunnuksella
kirjauta palveluihin, jossa on OpenID käytössä
- SAML pohjautuu XML:n, samaan ongelmaan ratkaisu kuin OpenID
- Moderint auth menetelmät ovat kolme viimeistä eli OAuth2, OpenID ja SAML


- Web sessioon kuuluu: pre-authentication, auth process, session management, acces control ja session finalization
- Webbi softan sessio voi jo ensimmäisen anonyymin pyynnön jälkeen muistaa asioita kuten esim. käyttäjän kiele
- Verkosta löytyy muisti lista autentikaatiolle ![OWASP Authentication Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
- Käyttäjillä on SessionID:t, se jaetaan käyttäjän ja webbi softan välillä session ajan, sen on oltava riittävän pitkä, että bruteforce
hyökkäykset vältetään
- ID:n ei pitäisi olla url:ssa, koskaa muuten sessiota voi manipuloida
- Koko Web sessio pitää enkryptata

Lähde: ![Percival & Samancioglu 2020](https://learning.oreilly.com/videos/the-complete-ethical/9781839210495/9781839210495-video21_1)

- XSS on clientissa ajettaavaa javascript koodia
- Syöttökenttään voi laittaa <script></script> tagit ja kirjoittaa niiden väliin javascript koodia joka ajetaan kun linkki avataan
- Jos sivu tallentaa käyttjän syöttämää dataa voi sivulle kirjoittaa javascript koodia tekstikenttään ja koodia ajetaan kun
avataan sivu
- BEEF työkalulla voi asettaa haitallista koodai linkin taakse joka ajetaan aina kun sivulle tullaan jos sivu tallentaa näitä viestejä
- Jos on rajoitettu sitä kuinka paljon voi kirjoittaa tekstikenttään voi sitä käydä muuttamassa selaimen kehittäjä työkaluilla
- Suojautuakseen tältä voi selaimessa kieltää javascriptin käytön mutta, koska nettisivut käyttävät paljon javascriptiä nykyään tämä voi
rikkoa selaimessasi nettisivujen sisältöä
- Eri sivuja voi myös sallia tai kieltää erikseen käyttämästä javascriptiä


## Rikun opit
Käytetty uutinen: ![Business insider](https://www.businessinsider.com/hackers-social-engineering-power-company-2016-4?r=US&IR=T)
Käytin tätä, koska en löytänyt mistään tapahtumaa jossa joku olisi luvatta tunkeutunut yritykseen. Tässä uutisessä on RedTeam tunkeutunut
kohteeseen. Linkissä on ReadTeamingistä kahteen kohteeseen. Vertaan Rikun slideja toiseen, koska siinä päästiin oikeasti tavoitteeseen.

- Tämä oli mielestäni todella hyvin toteutettu hyökkäys ja en keksinyt parannuskeinoja. Tässä oli esim. jo edellisenä päivän soitettu, että
tulisi vierailemaan opiskelijoita toimistoon ja haluttaisiin tulla haastattelemaan jotain, jolloin saatiin oikea nimi tältä henkilöltä. 
Hyökkääjät olivat myös itsevarmoja ja ajattelivat nopeasti kun tuli hetki, että olisivat voineet jäädä kiinni.
- Tämän hyökkäyksen olisi voinut, estää tarkistamalla ID:t ja laukut, jossa toisella hyökkääjällä oli RFID lukija laukussa.

## Rikun viitteet
Lähde: ![Osint technology blogi](https://www.osinttechniques.com/blog/open-source-intelligence-osint-how-to-guide)
Luin lähteessä merkityn blogin OSINT:sta, johon päädyin Rikun viitteiden kautta

- Hyviä asioita mistä aloittaa tutkiminen on:
        - nimi
        - sähköposti
        - puhelin numero
        - koti osoite
        - verkkosivut
        - yrityksen nimi
- Hyödynnä etsinnöissä Deep webbiä
- Vain jonkun Facebook tunnuksen löytäminen ei ole OSINT:a, kysy itseltäsi:
        - kuka
        - mitä
        - missä
        - miten
- Yhdistä pisteet keräämästäsi datasta ja muunna raakadata tiedoksi
- OSINT luodaan ei vain kerätä

## Vuohi etenee

### A2 Broken Authentication, Authentication bypass
- Tehtävässä piti resetoida salasana, mutta käytät laitetta mitä palvelun tarjoaja ei tunnista. Joudut käyttämään siis turvakysymyksiä mutta
et muista vastauksia niihin ja vastaukset on tallennettu jollekkin toiselle laitteelle.
- Koska teoria osuudessa puhuttiin proxyn käyttämisestä niin avasin brupsuiten ja käynnistin selaimen burpsuiten proxylla. Ensin koitin
ottaa POST datasta securityQuestionit kokaan pois, koska näin oli esimerkissä mutta tämä ei jostain syystä toiminut. Seuraavaksi etsin
verkosta ja löysin ![tästä videosta](https://www.youtube.com/watch?v=KZrJbYnHYa4) mitä tehtävässä piti tehdä. Muutin siis secQuestion0 ja
secQuestion1 muotoon secQuestion00 ja secQuestion01 ja tämän jälkeen pääsin vaihtamaan salasanan.

### A2 Broken Authentication, Secure Passowrds
- Tässä osassa oli ensin tietoa siitä miten muodostetaan turvallinen salasana ja mitä palvelun tekijän pitäisi tehdä salsanan teko vaiheeseen,
jotta käyttäjän olisi helpompi luoda vahva ja turvallinen salasana.
- Lopuksi kerrottiin myös mistä näkee onko salasanaasi cräkätty jo vai ei ja miten parantaa käyttäjätunnusten turvaa, kuten eri salasana
kaikille käyttäjille, käytä lauseita, käytä salasana manageria ja 2fa käyttö

### A3 Sensitive data exposure
- Tässä tehtävässä piti saada toisen käyttäjät tunnukset kun painaa login nappia joten avasin taas burpsuiten ja selaimen sitä kautta.
Käyttäjä tunnuksen ja salasanan sai burbsuiten avulla samantien haltuun. Ja syöttämällä nämä tunnukset kenttään tehtävä meni läpi.

### A7 Cross Site Scripting
- Ensimmäisessä tehtävässä (What is XSS) piti katsoa, avata uusi sivu samaan WebGoat instanssiin ja katsoa, että onko niillä sama sessionID. 
Tehtävässä ohjeistettiin laittamaan koodi url palkkiin mutta tämä ei enään toimi uusimmissa firefoxeissa, joten koitin käyttää developer 
työkaluista löytyvää konsolia ja siellä pystyi käyttämään javascript koodia, joten ajoin koodin `alert(document.cookie)` siellä ja
sain molemmilla sivuilla keksit näkyviin. Molemmilla sivuilla oli sama sessionID.

- Toisessa tehtävässä (Reflected XSS) piti ensin löytää syöttö kenttä mihin voi tehdä xss hyökkäyksen. Tässä tehtävässä se oli kenttä mihin
asetettiin luottokortin numero. Koitin löytämistä syöttämllä koodin `<script>alert()</script>` eri kenttiin. Tässä vaiheessa sai kokeilla
mitä tahansa javascript koodia ja tehtävä meni läpi sillä, että löysi xss:lle alttiin kentän.


## Tehtävien linkki lisätty myös Teron sivuille
## Tehtävien lähteet
![terokarvinen.com](https://terokarvinen.com/2021/hakkerointi-kurssi-tunkeutumistestaus-ict4tn027-3005/)
